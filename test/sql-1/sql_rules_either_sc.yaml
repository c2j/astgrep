rules:
 - id: sql-performance-issue-where-exists-in-with-orderby
   patterns:
     - pattern-either:
         - pattern: |
             SELECT $... FROM $T1 WHERE  EXISTS ($SUBQUERY) $... ORDER BY $...;
         - pattern: |
             SELECT $... FROM $T1 WHERE  $COL IN ($SUBQUERY) $... ORDER BY $...;
     - pattern-not: |
         SELECT /*+ SET_VAR(optimizer_switch = 'semijoin=off') */ $... FROM $T1 WHERE EXISTS ($SUBQUERY) $... ORDER BY $...;
     - pattern-not: |
         SELECT /*+ SET_VAR(optimizer_switch = 'semijoin=off') */ $... FROM $T1 WHERE $COL IN ($SUBQUERY) $... ORDER BY $...;
   message: |
     SQL语句包含WHERE EXISTS/IN子查询和ORDER BY排序，迁移后可能出现性能问题。
     请重点关注性能测试情况，如需优化可添加hint: /*+ SET_VAR(optimizer_switch = 'semijoin=off') */
   languages: [sql]
   severity: WARNING

 - id: sql-performance-issue-nested-exists
   patterns:
     - pattern: |
         SELECT $... FROM $T WHERE EXISTS (SELECT $... FROM $T2 WHERE EXISTS ($...))
     - pattern-not: |
         SELECT /*+ SET_VAR(optimizer_switch = 'semijoin=off') */ $... FROM $T WHERE EXISTS (SELECT $... FROM $T2 WHERE EXISTS ($...))
   message: |
     SQL语句包含两重及以上EXISTS嵌套查询，迁移后可能出现性能问题。
     请重点关注性能测试情况，如需优化可添加hint: /*+ SET_VAR(optimizer_switch = 'semijoin=off') */
   languages: [sql]
   severity: WARNING

