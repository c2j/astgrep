rules:
  - id: DB-SQ-09
    message: "多表连接必须指定连接条件（如ON、USING等），避免连接结果为笛卡儿积"
    languages: [java, generic]
    severity: WARNING
    
    patterns:
      # 检测 JOIN 语句但没有 ON 或 USING 条件
      - patterns:
          - pattern-regex: "(?i)\\bJOIN\\s+\\w+(?:\\s+\\w+)?\\s*(?:WHERE|GROUP|ORDER|LIMIT|$|;)"
          - pattern-not-regex: "(?i)\\bON\\b|\\bUSING\\b"
          
      # 检测 INNER JOIN 没有条件
      - patterns:
          - pattern-regex: "(?i)\\bINNER\\s+JOIN\\s+\\w+(?:\\s+\\w+)?\\s*(?:WHERE|GROUP|ORDER|LIMIT|$|;)"
          - pattern-not-regex: "(?i)\\bON\\b|\\bUSING\\b"
          
      # 检测 LEFT JOIN 没有条件  
      - patterns:
          - pattern-regex: "(?i)\\bLEFT\\s+JOIN\\s+\\w+(?:\\s+\\w+)?\\s*(?:WHERE|GROUP|ORDER|LIMIT|$|;)"
          - pattern-not-regex: "(?i)\\bON\\b|\\bUSING\\b"
          
      # 检测 RIGHT JOIN 没有条件
      - patterns:
          - pattern-regex: "(?i)\\bRIGHT\\s+JOIN\\s+\\w+(?:\\s+\\w+)?\\s*(?:WHERE|GROUP|ORDER|LIMIT|$|;)"
          - pattern-not-regex: "(?i)\\bON\\b|\\bUSING\\b"
